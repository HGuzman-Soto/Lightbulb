{% extends "layout.html" %}

{% block content %}

<div id="classroom-container">
	<div class="titlebar" style="border-bottom:1px solid black;">
		<!-- Classroom Title -->
		<button class="btn-sm editTitle general-btn classroomname" id="classroom-{{classroom.id}}"
		        onclick="showEditClassroom({{ classroom.id }})" aria-label="edit classroom name">
			{{classroom.name}}
			<span style="float:right; opacity:0.5; font-size:2vw;">
                    <i class="fas fa-pencil-alt" aria-hidden="true"></i>
                </span>
		</button>
		<!-- Title edit form -->
		<form id="classroom-form-{{classroom.id}}" style="display: none;"
		      action="{{ url_for('classrooms.edit_classroom_name', classroom_id=classroom.id) }}">
			{{form.hidden_tag()}}
			<fieldset class="editTitle general-btn form-group edit-classroom-form">
				<div class="form-group">
					{% if form.name.errors %}
					{{form.name(placeholder='Enter new name '
					,id='classroomname-content-'~classroom.id,value=classroom.name, maxlength='20', class='form-control
					form-control-lg is-invalid editTitle editTitle classroomname')}}
					<div class="invalid-feedback">
						{% for error in form.name.errors %}
						{{ error }}
						{% endfor %}
					</div>
					{% else %}
					{{form.name(placeholder='Enter new name '
					,id='classroomname-content-'~classroom.id,value=classroom.name, maxlength='20', class='form-control
					form-control-lg editTitle editTitle classroomname')}}
					{% endif %}
				</div>
			</fieldset>
			<div class=form-group"> {{form.submitClass(class='btn btn-sm btn-outline-info',
				type='submit',id='submit-classroom-'~classroom.id, value='Save')}}
				<input type="reset" class="btn btn-sm btn-outline-danger" name="Cancel" value="Cancel"
				       onclick="cancelEditClassroom({{classroom.id}})">
			</div>
		</form>
		<!-- Save button -->
		<button class="btn-sm save-and-exit sideClick general-btn"
		        onclick="window.location.href='{{ url_for('users.classrooms') }}';">
			<i class="fas fa-cloud-upload-alt" aria-hidden="true"></i> Save and Exit
		</button>
	</div>
	<!-- List of added quizzes -->
	<div class="quizlist" id="quizzes-{{classroom.id}}">
		<!-- Heading and add-quiz button -->
		<div id="ActiveRoomsHeader" style="font-size: 2.2vw;">
			<h4 class="Active-Rooms">Added Quizzes</h4>
			<button class="btn-sm sideClick general-btn"
			        onclick="window.location.href='{{ url_for('classrooms.add_quiz', classroom_id=classroom.id) }}';"><i
					class="fas fa-plus" aria-hidden="true"></i> Add a Quiz
			</button>
		</div>
		<div style="clear: both;"></div>
		<!-- actual quiz data/options -->
		<table id="added-quizzes-table" class="dt-responsive row-border stripe hover" style="width: 100%;">
			<thead>
				<tr>
					<td class="text-center ">Name</td>
					<td class="text-center">Date Created</td>
					<td class="text-center">Options</td>
				</tr>
			</thead>
			<tbody>
				{% for quiz in classroom.added_quizzes|sort(attribute="name") %}
				<!-- JavaScript option to set the current quiz in the list to active -->
				{%if classroom.generate_qr%}
				{%include 'qr_code_modal.html'%}
				{%endif%}
				<tr id="quiz-{{ quiz.id }}" class="table-element">

					<td class="col-4"><a href="{{ url_for('quizzes.quiz', quiz_id=quiz.id) }}">{{ quiz.name }}</a></td>
					<td class="col-4 text-center date-created" style="padding-left: 3%;">{{ quiz.date_created.strftime("%m/%d/%y") }}</td>
					{% if quiz.id != classroom.active_quiz %}
					<td class="col-4 quiz-icon-col">
						<button id="set-active-{{classroom.id}}" class="btn general-btn"
						        data-toggle="modal" {% if classroom.active_quiz %} data-target="#quiz_active_modal" {%
						        else %} data-target="#set_active_modal-{{quiz.id}}" {% endif %}>
							Set Active
						</button>

						{%include 'set_active_modal.html'%}
						<!-- TODO when un-setting a diff quiz, this one doesn't get activated; also the modal doesn't tell you which quiz you're deactivating -->
						{%include 'editing_quiz_warning_modal.html'%}
						<!-- TODO make this actually remove this quiz from the current classroom, instead of deleting the current classroom -->
						<button type="button" class="btn btn-sm general-btn"
						        aria-label="unlink this quiz">
							<i style="color: darkred;" class="account-page-icons fa fa-2x fa-times" aria-hidden="true"></i><br>
						</button>
					</td>
					{% else %}
					<td class="col-4 quiz-icon-col unset-active-btn">
						{%if classroom.generate_qr%}
						<button class="btn btn-sm btn-outline-info" data-toggle="modal"
						        data-target="#qr_code_modal-{{quiz.id}}"> Show QR CODE
						</button>
						{%endif%}
						<button id="remove-active-{{classroom.id}}" class="btn general-btn"
						        onclick="remove_active({{classroom.id}})">
							Unset Active
						</button>
					</td>
					{% endif %}
				</tr>
				{%endfor%}</tbody>
		</table>
	</div>
</div>

{% if (current_user.is_authenticated) and (classroom.owner == current_user) %}
<div class="classroom-options">
	{% if classroom.active_quiz %}
	<button id="take-active-quiz" class="btn general-btn"
	        onclick="window.location.href='{{ url_for('classrooms.take_quiz', classroom_id=classroom.id) }}';">Take
		Active Quiz <i class="fas fa-door-open"></i></button>
	{% if has_responses %}
	<button id="view-results" class="btn general-btn"
	        onclick="window.location.href='{{ url_for('classrooms.view_results', classroom_id=classroom.id) }}';"><i
			class="fas fa-chart-bar" aria-hidden="true"></i> View Results
	</button>
	{% endif %}
	<div style="clear: both;"></div>
	{% endif %}
</div>
{% endif %}
<script src="{{url_for('static', filename='js/set_active.js')}}" type="text/javascript"></script>
<script src="{{url_for('static', filename='js/Classroom.js')}}" type="text/javascript"></script>
{% endblock %}
